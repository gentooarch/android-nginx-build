```yaml
name: Build Nginx for Android

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ANDROID_NDK_VERSION: r25c
      NGINX_VERSION: 1.24.0
      OPENSSL_VERSION: 3.1.1
      PCRE2_VERSION: 10.42
      # 更新 zlib 版本并使用更可靠的来源
      ZLIB_VERSION: 1.3.1
      TARGET_ARCH: aarch64-linux-android
      API_LEVEL: 24

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup NDK
        run: |
          cd /opt
          sudo wget -q https://dl.google.com/android/repository/android-ndk-${{ env.ANDROID_NDK_VERSION }}-linux.zip
          sudo unzip -q android-ndk-${{ env.ANDROID_NDK_VERSION }}-linux.zip
          echo "ANDROID_NDK_HOME=/opt/android-ndk-${{ env.ANDROID_NDK_VERSION }}" >> $GITHUB_ENV

      - name: Download Sources
        run: |
          wget http://nginx.org/download/nginx-${{ env.NGINX_VERSION }}.tar.gz && tar -xzf nginx-${{ env.NGINX_VERSION }}.tar.gz
          wget https://github.com/PCRE2Project/pcre2/releases/download/pcre2-${{ env.PCRE2_VERSION }}/pcre2-${{ env.PCRE2_VERSION }}.tar.gz && tar -xzf pcre2-${{ env.PCRE2_VERSION }}.tar.gz
          wget https://www.openssl.org/source/openssl-${{ env.OPENSSL_VERSION }}.tar.gz && tar -xzf openssl-${{ env.OPENSSL_VERSION }}.tar.gz
          # 修复点：改用 github 镜像下载 zlib，避免 404
          wget https://github.com/madler/zlib/releases/download/v${{ env.ZLIB_VERSION }}/zlib-${{ env.ZLIB_VERSION }}.tar.gz && tar -xzf zlib-${{ env.ZLIB_VERSION }}.tar.gz

      - name: Build Nginx
        run: |
          export TOOLCHAIN=$ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64
          export SYSROOT=$TOOLCHAIN/sysroot
          export CC=$TOOLCHAIN/bin/${{ env.TARGET_ARCH }}${{ env.API_LEVEL }}-clang
          export AR=$TOOLCHAIN/bin/llvm-ar
          export AS=$TOOLCHAIN/bin/${{ env.TARGET_ARCH }}${{ env.API_LEVEL }}-clang
          export RANLIB=$TOOLCHAIN/bin/llvm-ranlib
          export LD=$TOOLCHAIN/bin/ld
          export STRIP=$TOOLCHAIN/bin/llvm-strip

          cd nginx-${{ env.NGINX_VERSION }}
          
          # 核心修复：Nginx 交叉编译补丁
          # 1. 强制设置 sizeof 结果，防止 configure 运行测试程序
          sed -i 's/ngx_size=`$NGX_AUTOTEST`/ngx_size=8/g' auto/types/sizeof
          
          # 2. 绕过特征检查 (ngx_autotest)
          # Nginx 默认会尝试运行生成的二进制文件来检查系统特性，但在交叉编译环境下会报错
          # 我们需要手动告诉它一些 Linux 的通用特性
          sed -i 's/if \[ $ngx_rc -ne 0 \]; then/if [ $ngx_rc -eq 999 ]; then/' auto/feature

          ./configure \
            --with-cc=$CC \
            --with-cpp=$CC \
            --with-ld-opt="-static-symbols" \
            --crossbuild=android-arm64 \
            --with-pcre=../pcre2-${{ env.PCRE2_VERSION }} \
            --with-openssl=../openssl-${{ env.OPENSSL_VERSION }} \
            --with-zlib=../zlib-${{ env.ZLIB_VERSION }} \
            --with-http_ssl_module \
            --with-http_v2_module \
            --prefix=/data/local/tmp/nginx \
            --conf-path=/data/local/tmp/nginx/nginx.conf \
            --error-log-path=/data/local/tmp/nginx/logs/error.log \
            --http-log-path=/data/local/tmp/nginx/logs/access.log \
            --pid-path=/data/local/tmp/nginx/nginx.pid \
            --lock-path=/data/local/tmp/nginx/nginx.lock \
            --without-http_rewrite_module \
            --without-http_gzip_module

          # 针对某些 NDK 版本可能需要的特殊处理
          make -j$(nproc)
          make install DESTDIR=$(pwd)/out

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: nginx-android-bin
          path: nginx-${{ env.NGINX_VERSION }}/out/data/local/tmp/nginx/
